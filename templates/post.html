{{define "post.html"}}
    {{template "header" .}}
    <div class="post-container">
        <article class="post-full">
            <h1>{{.Post.Title}}</h1>
            <div class="post-meta">
                <time>{{ .Post.CreatedAt }}</time>
                <span class="author">By {{ .Post.Username }}</span>
                
                {{ if .Post.Categories }}
                    <span class="post-categories">
                        {{ range $index, $category := .Post.Categories }}
                            {{ if $index }}, {{ end }}
                            <a href="/categories#{{ $category | urlquery }}">{{ $category }}</a>
                        {{ end }}
                    </span>
                {{ end }}

                {{if or (eq .Post.UserID $.User.ID) $.User.IsAdmin}}
                    <div class="post-actions">
                        <a href="/post/edit/{{.Post.ID}}" class="edit-btn">‚úèÔ∏è Edit</a>
                        <form method="POST" action="/api/post/delete" style="display: inline;">
                            <input type="hidden" name="post_id" value="{{.Post.ID}}">
                            <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this post? This action cannot be undone.')">
                                üóëÔ∏è Delete
                            </button>
                        </form>
                    </div>
                {{end}}
            </div>
            <div class="post-content">
                {{.Post.Content}}
            </div>
            <div class="reactions">
                <button class="like-btn {{if .Post.UserLiked}}active{{end}}" 
                        data-post-id="{{.Post.ID}}" 
                        data-type="like">
                    üëç {{.Post.Likes}}
                </button>
                <button class="dislike-btn {{if .Post.UserDisliked}}active{{end}}" 
                        data-post-id="{{.Post.ID}}" 
                        data-type="dislike">
                    üëé {{.Post.Dislikes}}
                </button>
            </div>
        </article>

        {{if .User}}
            <div class="comment-form">
                <h3>Add Comment</h3>
                <form method="POST" action="/api/comment">
                    <input type="hidden" name="post_id" value="{{.Post.ID}}">
                    <textarea name="content" required placeholder="Write your comment here"></textarea>
                    <button type="submit">Submit</button>
                </form>
            </div>
        {{else}}
            <div class="login-prompt">
                <p>Please <a href="/login">log in</a> to add comments.</p>
            </div>
        {{end}}

        <div class="comments">
            <h3>Comments</h3>
            {{if .Comments}}
                {{range .Comments}}
                    <div class="comment">
                        <div class="comment-meta">
                            <span>{{.Username}}</span>
                            <span>{{.CreatedAt.Format "02 Jan 2006 15:04"}}</span>
                            {{if or (eq .UserID $.User.ID) $.User.IsAdmin}}
                                <div class="comment-actions">
                                    <button onclick="toggleEditComment({{.ID}})" class="edit-btn">
                                        ‚úèÔ∏è Edit
                                    </button>
                                    <form method="POST" action="/api/comment/delete" style="display: inline;">
                                        <input type="hidden" name="comment_id" value="{{.ID}}">
                                        <input type="hidden" name="post_id" value="{{$.Post.ID}}">
                                        <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this comment?')">
                                            üóëÔ∏è Delete
                                        </button>
                                    </form>
                                </div>
                            {{end}}
                        </div>
                        <div class="comment-content" id="comment-content-{{.ID}}">
                            {{.Content}}
                        </div>
                        {{if or (eq .UserID $.User.ID) $.User.IsAdmin}}
                            <div class="edit-form" id="edit-form-{{.ID}}" style="display: none;">
                                <form method="POST" action="/api/comment/edit">
                                    <input type="hidden" name="comment_id" value="{{.ID}}">
                                    <input type="hidden" name="post_id" value="{{$.Post.ID}}">
                                    <textarea name="content" required>{{.Content}}</textarea>
                                    <div class="button-group">
                                        <button type="submit">Save</button>
                                        <button type="button" onclick="toggleEditComment({{.ID}})">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        {{end}}
                        <div class="reactions" id="comment-{{.ID}}">
                            <button onclick="reactToComment({{.ID}}, 'like')" 
                                    class="comment-like-btn {{if .UserLiked}}active{{end}}">
                                üëç <span class="likes-count">{{.Likes}}</span>
                            </button>
                            <button onclick="reactToComment({{.ID}}, 'dislike')" 
                                    class="comment-dislike-btn {{if .UserDisliked}}active{{end}}">
                                üëé <span class="dislikes-count">{{.Dislikes}}</span>
                            </button>
                        </div>
                    </div>
                {{end}}
            {{else}}
                <p>No comments yet.</p>
            {{end}}
        </div>
    </div>
    <script src="/static/js/reactions.js"></script>
    <script src="/static/js/comments.js"></script>
    {{template "footer" .}}
{{end}} 